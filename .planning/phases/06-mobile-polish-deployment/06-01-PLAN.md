---
phase: 06-mobile-polish-deployment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/mobile/src/context/LocationContext.tsx
  - packages/mobile/src/services/socket/index.ts
  - packages/mobile/src/screens/MapScreen.tsx
autonomous: true
---

<objective>
Add ghost mode - ability to pause location sharing while staying connected.

Purpose: Users can temporarily hide their location from family without fully disconnecting. They continue receiving family locations but don't broadcast their own.
Output: Ghost mode toggle on MapScreen, state managed in LocationContext.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@packages/mobile/src/context/LocationContext.tsx
@packages/mobile/src/services/socket/index.ts
@packages/mobile/src/screens/MapScreen.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ghost mode state to LocationContext and socket service</name>
  <files>packages/mobile/src/context/LocationContext.tsx, packages/mobile/src/services/socket/index.ts</files>
  <action>
  1. In LocationContext.tsx:
     - Add `isGhostMode: boolean` state (default false)
     - Add `toggleGhostMode: () => void` to context value
     - Store ghost mode in SecureStore key `draugar_ghost_mode` for persistence across app restarts
     - Load ghost mode state on mount from SecureStore

  2. In socket/index.ts:
     - Export `setGhostMode(enabled: boolean)` function
     - Add module-level `ghostMode` flag
     - Modify `sendLocationUpdate` to return early if ghostMode is true (don't emit, just log)

  3. In LocationContext, call `setGhostMode` when ghost mode changes

  Key behavior: Ghost mode pauses OUTGOING location broadcasts only. User still receives family locations.
  </action>
  <verify>TypeScript compiles: cd packages/mobile && pnpm typecheck</verify>
  <done>Ghost mode state exists in context, toggleable, persisted to SecureStore, socket skips sending when enabled</done>
</task>

<task type="auto">
  <name>Task 2: Add ghost mode toggle UI to MapScreen</name>
  <files>packages/mobile/src/screens/MapScreen.tsx</files>
  <action>
  Add ghost mode toggle button to MapScreen:

  1. Import `toggleGhostMode` and `isGhostMode` from useLocation()
  2. Add a second button or icon above the main sharing button:
     - When ghost mode OFF: Ghost icon (outline) with label "Go Invisible"
     - When ghost mode ON: Ghost icon (filled) with label "Visible" and different color (gray background)
  3. Button onPress calls toggleGhostMode()
  4. When ghost mode is ON and tracking is ON, show subtle indicator that "You're invisible to family"

  Style the button to be clearly secondary to the main Share/Stop button:
  - Smaller, positioned above main button
  - Use ghost icon (ðŸ‘» emoji is fine for MVP) or text
  - Gray when active (invisible), subtle when inactive
  </action>
  <verify>Run app in simulator, toggle ghost mode, verify UI updates</verify>
  <done>Ghost mode toggle visible on map, state changes reflected in UI, indicator shows when invisible</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm typecheck` passes in mobile package
- [ ] Ghost mode toggle appears on MapScreen
- [ ] Toggling ghost mode updates UI immediately
- [ ] Ghost mode persists after app restart (check SecureStore)
- [ ] When ghost mode ON: location updates not sent (check console logs)
- [ ] When ghost mode ON: still receive family location updates
</verification>

<success_criteria>
- All tasks completed
- Ghost mode toggleable from MapScreen
- State persists across app restarts
- Outgoing location updates blocked when ghost mode active
- Incoming family locations still received in ghost mode
</success_criteria>

<output>
After completion, create `.planning/phases/06-mobile-polish-deployment/06-01-SUMMARY.md`
</output>
