---
phase: 06-mobile-polish-deployment
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/mobile/src/screens/SettingsScreen.tsx
  - packages/mobile/src/services/location/locationService.ts
  - packages/mobile/src/navigation/RootNavigator.tsx
  - packages/mobile/src/screens/HomeScreen.tsx
autonomous: true
---

<objective>
Add settings screen with battery optimization controls.

Purpose: Let users choose update frequency to balance battery life vs location accuracy.
Output: SettingsScreen with frequency presets, integrated into navigation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@packages/mobile/src/services/location/locationService.ts
@packages/mobile/src/navigation/RootNavigator.tsx
@packages/mobile/src/screens/HomeScreen.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SettingsScreen with update frequency options</name>
  <files>packages/mobile/src/screens/SettingsScreen.tsx</files>
  <action>
  Create SettingsScreen.tsx with:

  1. Three frequency presets (radio button style):
     - "Battery Saver" - 100m distance, 5 min interval (low accuracy, best battery)
     - "Balanced" - 50m distance, 1 min interval (current default)
     - "High Accuracy" - 20m distance, 30 sec interval (best accuracy, worst battery)

  2. Store selected preset in SecureStore key `draugar_update_frequency` (values: "low", "balanced", "high")

  3. Load current setting on mount, default to "balanced"

  4. On selection change, save to SecureStore immediately

  5. Add explanatory text under each option about battery impact

  6. Add logout button at bottom (move from HomeScreen)

  Style: Simple list with radio buttons, similar to iOS Settings app. Use existing color scheme (#4A90A4 primary).
  </action>
  <verify>TypeScript compiles: cd packages/mobile && pnpm typecheck</verify>
  <done>SettingsScreen exists with three frequency presets, persisted to SecureStore</done>
</task>

<task type="auto">
  <name>Task 2: Wire settings to location service and navigation</name>
  <files>packages/mobile/src/services/location/locationService.ts, packages/mobile/src/navigation/RootNavigator.tsx, packages/mobile/src/screens/HomeScreen.tsx</files>
  <action>
  1. In locationService.ts:
     - Add `getUpdateFrequencySettings()` async function that reads from SecureStore
     - Returns { distanceInterval: number, deferredUpdatesInterval: number }
     - Map presets: low (100, 300000), balanced (50, 60000), high (20, 30000)
     - Modify `startLocationUpdates` to call getUpdateFrequencySettings() and use returned values

  2. In RootNavigator.tsx:
     - Add "Settings" to RootStackParamList
     - Add Stack.Screen for SettingsScreen
     - Import SettingsScreen

  3. In HomeScreen.tsx:
     - Remove logout button (moved to Settings)
     - Add "Settings" navigation button (gear icon or text)
     - Add "View Map" navigation button
     - Make it a simple hub: Welcome message + two buttons (Map, Settings)

  Navigation: Home is now a hub. User can go to Map or Settings from Home.
  </action>
  <verify>Run app, navigate to Settings, change frequency, restart location tracking, verify new intervals used</verify>
  <done>Settings accessible from Home, frequency selection affects location tracking intervals</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm typecheck` passes in mobile package
- [ ] SettingsScreen accessible from HomeScreen
- [ ] Three frequency options displayed with descriptions
- [ ] Selection persists after app restart
- [ ] Changing frequency and restarting tracking uses new intervals (verify via console logs)
- [ ] Logout works from Settings screen
</verification>

<success_criteria>
- All tasks completed
- Settings screen navigable from Home
- Frequency presets work and persist
- Location service uses selected frequency
- Clean navigation flow: Home → Map or Home → Settings
</success_criteria>

<output>
After completion, create `.planning/phases/06-mobile-polish-deployment/06-02-SUMMARY.md`
</output>
