---
phase: 05-realtime-location
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/mobile/package.json
  - packages/mobile/app.json
autonomous: true
---

<objective>
Install location and map dependencies, configure Expo plugins for background location.

Purpose: Set up the native modules required for location tracking and map display before implementation.
Output: Dependencies installed, Expo config plugins configured, development build required.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-realtime-location/05-RESEARCH.md

@packages/mobile/package.json
@packages/mobile/app.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install location and map dependencies</name>
  <files>packages/mobile/package.json</files>
  <action>
Run from packages/mobile directory:
```
npx expo install expo-location expo-task-manager @maplibre/maplibre-react-native
```

This installs:
- expo-location: Foreground + background location tracking
- expo-task-manager: Background task registration for location updates
- @maplibre/maplibre-react-native: Privacy-respecting maps with OSM tiles

Do NOT install react-native-background-geolocation (paid license, overkill for family app).
  </action>
  <verify>Check packages/mobile/package.json contains expo-location, expo-task-manager, @maplibre/maplibre-react-native</verify>
  <done>All three packages appear in dependencies with compatible versions</done>
</task>

<task type="auto">
  <name>Task 2: Configure Expo plugins for location and MapLibre</name>
  <files>packages/mobile/app.json</files>
  <action>
Add config plugins to app.json expo.plugins array:

```json
"plugins": [
  "@maplibre/maplibre-react-native",
  [
    "expo-location",
    {
      "locationAlwaysAndWhenInUsePermission": "Allow Draugar to access your location for family location sharing.",
      "locationAlwaysPermission": "Allow Draugar to track your location in the background for family location sharing.",
      "locationWhenInUsePermission": "Allow Draugar to access your location while using the app.",
      "isAndroidBackgroundLocationEnabled": true,
      "isAndroidForegroundServiceEnabled": true
    }
  ]
]
```

If plugins array doesn't exist, create it. If it exists, append to it.

The permission strings explain why background location is needed (family location sharing).
  </action>
  <verify>cat packages/mobile/app.json shows plugins array with both @maplibre/maplibre-react-native and expo-location with all permission strings</verify>
  <done>Both plugins configured with appropriate permission descriptions</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd packages/mobile && pnpm install` succeeds
- [ ] package.json contains expo-location, expo-task-manager, @maplibre/maplibre-react-native
- [ ] app.json has plugins array with both plugins configured
- [ ] expo-location plugin has all three permission strings
</verification>

<success_criteria>
- All tasks completed
- Dependencies installed without conflicts
- Expo plugins configured for background location
- Ready for Plan 02 (location service) and Plan 03 (map screen)
</success_criteria>

<output>
After completion, create `.planning/phases/05-realtime-location/05-01-SUMMARY.md`
</output>
