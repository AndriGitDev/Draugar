---
phase: 05-realtime-location
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - packages/mobile/src/screens/MapScreen.tsx
  - packages/mobile/src/navigation/AppNavigator.tsx
autonomous: true
---

<objective>
Implement MapLibre map screen with user location display using OpenFreeMap tiles.

Purpose: Display privacy-respecting map with user's current location, ready for family markers.
Output: MapScreen component with OpenFreeMap tiles and UserLocation indicator.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-realtime-location/05-RESEARCH.md

@packages/mobile/src/screens/HomeScreen.tsx
@packages/mobile/src/navigation/AppNavigator.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MapScreen with MapLibre and OpenFreeMap</name>
  <files>packages/mobile/src/screens/MapScreen.tsx</files>
  <action>
Create MapScreen.tsx using MapLibre React Native with OpenFreeMap tiles (free, no API key).

```typescript
import React, { useEffect } from 'react';
import { View, StyleSheet, Text } from 'react-native';
import MapLibreGL from '@maplibre/maplibre-react-native';

// OpenFreeMap - free OSM tiles, no API key needed
// Attribution is auto-handled by MapLibre when logoEnabled and attributionEnabled are true
const OPENFREEMAP_STYLE = 'https://tiles.openfreemap.org/styles/liberty/style.json';

// Initialize MapLibre (no token needed for OpenFreeMap)
MapLibreGL.setAccessToken(null);

interface FamilyMember {
  id: string;
  name: string;
  latitude: number;
  longitude: number;
  lastUpdated: Date;
}

interface MapScreenProps {
  familyMembers?: FamilyMember[];
}

export function MapScreen({ familyMembers = [] }: MapScreenProps): React.JSX.Element {
  return (
    <View style={styles.container}>
      <MapLibreGL.MapView
        style={styles.map}
        styleURL={OPENFREEMAP_STYLE}
        logoEnabled={true}
        attributionEnabled={true}
      >
        <MapLibreGL.Camera
          zoomLevel={14}
          followUserLocation={true}
          followUserMode="normal"
          animationMode="flyTo"
          animationDuration={1000}
        />

        <MapLibreGL.UserLocation
          visible={true}
          animated={true}
          showsUserHeadingIndicator={true}
          minDisplacement={10}
        />

        {/* Family member markers - will be populated by Plan 04 */}
        {familyMembers.map((member) => (
          <MapLibreGL.MarkerView
            key={member.id}
            coordinate={[member.longitude, member.latitude]}
          >
            <View style={styles.marker}>
              <Text style={styles.markerText}>
                {member.name.charAt(0).toUpperCase()}
              </Text>
            </View>
          </MapLibreGL.MarkerView>
        ))}
      </MapLibreGL.MapView>
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
  },
  map: {
    flex: 1,
  },
  marker: {
    width: 40,
    height: 40,
    borderRadius: 20,
    backgroundColor: '#4A90A4',
    justifyContent: 'center',
    alignItems: 'center',
    borderWidth: 2,
    borderColor: '#fff',
    shadowColor: '#000',
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.25,
    shadowRadius: 4,
    elevation: 5,
  },
  markerText: {
    color: '#fff',
    fontWeight: 'bold',
    fontSize: 18,
  },
});

export default MapScreen;
```

Notes:
- OpenFreeMap style URL provides complete styling including labels
- setAccessToken(null) is required but no token needed for OpenFreeMap
- logoEnabled/attributionEnabled satisfy OSM attribution requirements
- FamilyMember interface prepared for Plan 04 integration
- Marker styling matches app color (#4A90A4 from foregroundService config)
  </action>
  <verify>File exists at packages/mobile/src/screens/MapScreen.tsx with MapLibreGL.MapView and UserLocation components</verify>
  <done>MapScreen renders OpenFreeMap tiles with user location indicator</done>
</task>

<task type="auto">
  <name>Task 2: Add MapScreen to navigation</name>
  <files>packages/mobile/src/navigation/AppNavigator.tsx</files>
  <action>
Update AppNavigator.tsx to include MapScreen in the navigation stack.

1. Import MapScreen:
```typescript
import { MapScreen } from '../screens/MapScreen';
```

2. Add to navigation stack (as authenticated screen, same level as HomeScreen):
```typescript
<Stack.Screen
  name="Map"
  component={MapScreen}
  options={{ title: 'Family Map' }}
/>
```

3. Add "Map" to the RootStackParamList type if it exists:
```typescript
type RootStackParamList = {
  // ... existing screens
  Map: undefined;
};
```

The MapScreen should be accessible after authentication. For now it can be a separate screen - Phase 6 will handle making it the default view and adding tab navigation if needed.
  </action>
  <verify>grep "MapScreen" packages/mobile/src/navigation/AppNavigator.tsx shows import and Stack.Screen</verify>
  <done>MapScreen accessible in navigation stack</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] packages/mobile/src/screens/MapScreen.tsx exists with MapLibreGL components
- [ ] MapScreen uses OPENFREEMAP_STYLE URL
- [ ] MapScreen has UserLocation component configured
- [ ] MapScreen has FamilyMember marker rendering (empty array for now)
- [ ] AppNavigator.tsx imports and includes MapScreen
- [ ] TypeScript compiles: cd packages/mobile && npx tsc --noEmit
</verification>

<success_criteria>
- All tasks completed
- MapScreen renders with OpenFreeMap tiles
- User location displays on map
- Navigation allows accessing map screen
- Ready for family marker integration in Plan 04
</success_criteria>

<output>
After completion, create `.planning/phases/05-realtime-location/05-03-SUMMARY.md`
</output>
