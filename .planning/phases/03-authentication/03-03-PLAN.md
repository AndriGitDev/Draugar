---
phase: 03-authentication
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified: [packages/mobile/src/utils/storage.ts, packages/mobile/src/context/AuthContext.tsx, packages/mobile/src/screens/JoinScreen.tsx, packages/mobile/src/navigation/RootNavigator.tsx, packages/mobile/App.tsx, packages/mobile/package.json]
autonomous: false
---

<objective>
Build mobile authentication screens and token storage for the join flow.

Purpose: Users can enter invite code on mobile, join the family, and stay authenticated.
Output: Working mobile auth flow with secure token storage.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plans in this phase
@.planning/phases/03-authentication/03-01-SUMMARY.md
@.planning/phases/03-authentication/03-02-SUMMARY.md

# Existing mobile code
@packages/mobile/App.tsx
@packages/mobile/package.json

# Shared types
@packages/shared/src/types/auth.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and create storage utilities</name>
  <files>packages/mobile/src/utils/storage.ts, packages/mobile/src/utils/api.ts, packages/mobile/package.json</files>
  <action>
Install expo-secure-store for secure token storage:
```
cd packages/mobile && npx expo install expo-secure-store
```

Create storage utilities (src/utils/storage.ts):
- `saveToken(token: string)`: Store JWT in SecureStore
- `getToken()`: Retrieve JWT from SecureStore
- `clearToken()`: Remove JWT from SecureStore
- Key: 'auth_token'

Create API utilities (src/utils/api.ts):
- `API_URL`: Read from env or default to 'http://localhost:3001'
- `apiRequest(endpoint, options)`: Fetch wrapper that adds Authorization header if token exists
- Handle common errors (network, 401)

Note: For local dev, use machine IP instead of localhost for device testing.
  </action>
  <verify>pnpm typecheck passes in mobile package</verify>
  <done>Storage and API utilities created, expo-secure-store installed</done>
</task>

<task type="auto">
  <name>Task 2: Create AuthContext and JoinScreen</name>
  <files>packages/mobile/src/context/AuthContext.tsx, packages/mobile/src/screens/JoinScreen.tsx</files>
  <action>
Create AuthContext (src/context/AuthContext.tsx):
- State: { user: { id, name } | null, isLoading: boolean }
- Actions: join(code, name), logout()
- On mount: check for stored token, validate with /api/auth/me
- Export AuthProvider and useAuth hook

Create JoinScreen (src/screens/JoinScreen.tsx):
- Two TextInput fields: invite code (uppercase, 8 chars max), name
- Join button calls auth.join()
- Show loading state during API call
- Show error message for invalid codes
- Simple styling with React Native StyleSheet (centered, clean)

Use AuthResponse type from @draugar/shared.
  </action>
  <verify>pnpm typecheck passes</verify>
  <done>AuthContext manages auth state, JoinScreen has form UI</done>
</task>

<task type="auto">
  <name>Task 3: Create navigation and wire up App</name>
  <files>packages/mobile/src/navigation/RootNavigator.tsx, packages/mobile/src/screens/HomeScreen.tsx, packages/mobile/App.tsx</files>
  <action>
Install React Navigation:
```
cd packages/mobile && npx expo install @react-navigation/native @react-navigation/native-stack react-native-screens react-native-safe-area-context
```

Create HomeScreen placeholder (src/screens/HomeScreen.tsx):
- Show "Welcome, {name}!" with user from AuthContext
- Logout button that calls auth.logout()

Create RootNavigator (src/navigation/RootNavigator.tsx):
- If not authenticated: show JoinScreen
- If authenticated: show HomeScreen
- Show loading spinner while checking auth state

Update App.tsx:
- Wrap with NavigationContainer and AuthProvider
- Render RootNavigator
  </action>
  <verify>pnpm typecheck passes, app compiles with expo start</verify>
  <done>Navigation switches between Join and Home based on auth state</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Mobile auth flow: JoinScreen, token storage, conditional navigation</what-built>
  <how-to-verify>
    1. Start backend: cd packages/backend && pnpm dev
    2. Create invite code: curl -X POST http://localhost:3001/api/invites -H "Content-Type: application/json" -d '{}'
    3. Start mobile: cd packages/mobile && pnpm start
    4. Open on device/simulator (scan QR or press 'i' for iOS, 'a' for Android)
    5. Enter the invite code and a name
    6. Tap Join - should navigate to HomeScreen showing "Welcome, {name}!"
    7. Close and reopen app - should stay logged in
    8. Tap Logout - should return to JoinScreen
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm typecheck` passes in mobile package
- [ ] expo-secure-store and navigation packages installed
- [ ] App compiles and runs on device/simulator
- [ ] Join flow works end-to-end
- [ ] Token persists across app restarts
- [ ] Logout clears token and returns to JoinScreen
</verification>

<success_criteria>
- All tasks completed
- User approved visual verification
- Mobile auth flow works end-to-end
- Token stored securely and persists
</success_criteria>

<output>
After completion, create `.planning/phases/03-authentication/03-03-SUMMARY.md`
</output>
