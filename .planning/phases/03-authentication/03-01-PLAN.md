---
phase: 03-authentication
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [packages/backend/src/utils/inviteCode.ts, packages/backend/src/routes/invites.ts, packages/backend/src/routes/index.ts]
autonomous: true
---

<objective>
Create invite code generation and validation backend endpoints.

Purpose: Enable admin to create invite codes and users to validate them before joining.
Output: Working /api/invites endpoints for code creation and validation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context
@.planning/phases/02-backend-core/02-01-SUMMARY.md
@.planning/phases/02-backend-core/02-02-SUMMARY.md

# Existing code to build on
@packages/backend/src/db/schema.ts
@packages/backend/src/routes/index.ts
@packages/backend/src/utils/ApiError.ts
@packages/shared/src/types/invite-code.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create invite code utility</name>
  <files>packages/backend/src/utils/inviteCode.ts</files>
  <action>
Create utility for generating secure invite codes:
- `generateInviteCode()`: Returns 8-character alphanumeric code using crypto.randomBytes
- Use uppercase letters and digits only (avoids ambiguous chars like 0/O, 1/l)
- Characters: ABCDEFGHJKLMNPQRSTUVWXYZ23456789 (26 letters minus I,O + 8 digits minus 0,1)

Example output: "K7HM3NP2"
  </action>
  <verify>Import and call generateInviteCode() in a test script - should return 8-char string</verify>
  <done>Utility function exported and generates unique 8-char codes</done>
</task>

<task type="auto">
  <name>Task 2: Create invite code API routes</name>
  <files>packages/backend/src/routes/invites.ts, packages/backend/src/routes/index.ts</files>
  <action>
Create /api/invites routes:

1. POST /api/invites - Create new invite code
   - Body: { expiresInHours?: number } (optional, null = never expires)
   - For now, no auth required (will add in 03-02)
   - Insert into invite_codes table using Drizzle
   - Response: { code: string, expiresAt: string | null }

2. POST /api/invites/validate - Check if code is valid
   - Body: { code: string }
   - Query invite_codes table: code exists, not used (usedBy is null), not expired
   - Response: { valid: boolean, code?: string } (code returned if valid for use in join flow)
   - Use ApiError.badRequest() for invalid/expired/used codes

Wire up invitesRouter in routes/index.ts under /invites path.
  </action>
  <verify>
curl -X POST http://localhost:3001/api/invites -H "Content-Type: application/json" -d '{}' returns a code
curl -X POST http://localhost:3001/api/invites/validate -H "Content-Type: application/json" -d '{"code":"<returned-code>"}' returns valid: true
  </verify>
  <done>Both endpoints work: create returns code, validate checks code status</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm typecheck` passes in backend package
- [ ] POST /api/invites creates code in database
- [ ] POST /api/invites/validate returns valid: true for unused code
- [ ] POST /api/invites/validate returns valid: false for nonexistent/used/expired code
</verification>

<success_criteria>
- All tasks completed
- Invite codes can be created and validated via API
- No TypeScript errors
- Codes stored in PostgreSQL via Drizzle
</success_criteria>

<output>
After completion, create `.planning/phases/03-authentication/03-01-SUMMARY.md`
</output>
